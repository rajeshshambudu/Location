<!DOCTYPE html>
<html>
<head>
<title>Dashboard</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="auth.js"></script>
<script src="data.js"></script>
</head>

<body class="bg-gray-100 p-6">
<script>protect()</script>

<h1 class="text-2xl font-bold mb-4">Admin Dashboard</h1>

<!-- ADD RESTAURANT -->
<div class="bg-white p-4 rounded shadow max-w-md">
  <input id="name" class="border p-2 w-full mb-2" placeholder="Restaurant Name">
  <input id="price" type="number" class="border p-2 w-full mb-2" placeholder="Price">
  <textarea id="images" class="border p-2 w-full mb-2"
    placeholder="Paste image URLs (one per line)"></textarea>

  <div id="preview" class="grid grid-cols-3 gap-2 mb-2"></div>

  <button onclick="add()" class="bg-green-600 text-white w-full py-2">
    Add Restaurant
  </button>
</div>

<!-- CHANGE PASSWORD -->
<div class="bg-white p-4 rounded shadow max-w-md mt-6">
  <input id="newpass" type="password" class="border p-2 w-full mb-2"
    placeholder="New Admin Password">
  <button onclick="changePassword(newpass.value)"
    class="bg-orange-500 text-white w-full py-2">
    Change Password
  </button>
</div>

<h2 class="font-bold mt-8 mb-2">Restaurants</h2>
<div id="list"></div>

<script>
let data = getData();

images.addEventListener("input", () => {
  preview.innerHTML = images.value
    .split("\n")
    .map(u => `<img src="${convertDriveLink(u)}"
      onerror="this.src='https://via.placeholder.com/150'"
      class="h-20 object-cover rounded">`)
    .join("");
});

function add(){
  data.push({
    name: name.value,
    price: Number(price.value),
    images: images.value.split("\n").map(convertDriveLink)
  });
  saveData(data);
  name.value = price.value = images.value = "";
  preview.innerHTML="";
  render();
}

function del(i){
  data.splice(i,1);
  saveData(data);
  render();
}

function render(){
  list.innerHTML = data.map((r,i)=>`
    <div class="bg-white p-3 rounded shadow mb-2 flex justify-between">
      <span>${r.name} (â‚¹${r.price})</span>
      <button onclick="del(${i})" class="text-red-500">Delete</button>
    </div>
  `).join("");
}
render();
</script>
</body>
</html>
