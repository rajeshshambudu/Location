<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 p-6">

<script>
if (localStorage.getItem("admin") !== "true") {
  window.location.href = "admin.html";
}
</script>

<h1 class="text-2xl font-bold mb-4">Admin Dashboard</h1>

<div class="bg-white p-4 rounded shadow max-w-md">
  <input id="name" placeholder="Restaurant Name"
         class="border p-2 w-full mb-2">

  <input id="price" type="number" placeholder="Price"
         class="border p-2 w-full mb-2">

  <input id="img" placeholder="Image URL / Google Drive Link"
         class="border p-2 w-full mb-2">

  <img id="preview" class="h-32 w-full object-cover rounded mb-2 hidden">

  <button onclick="addRestaurant()"
          class="bg-green-600 text-white w-full py-2 rounded">
    Add Restaurant
  </button>
</div>

<h2 class="font-bold mt-6 mb-2">Saved Restaurants</h2>
<div id="list"></div>

<script>
let data = JSON.parse(localStorage.getItem("restaurants")) || [];

function convertDrive(url) {
  if (url.includes("drive.google.com/file/d/")) {
    let id = url.split("/d/")[1].split("/")[0];
    return `https://drive.google.com/uc?export=view&id=${id}`;
  }
  return url;
}

img.addEventListener("input", () => {
  preview.src = convertDrive(img.value);
  preview.classList.remove("hidden");
});

function addRestaurant() {
  data.push({
    name: name.value,
    price: Number(price.value),
    img: convertDrive(img.value)
  });

  localStorage.setItem("restaurants", JSON.stringify(data));
  name.value = price.value = img.value = "";
  preview.classList.add("hidden");
  render();
}

function removeItem(i) {
  data.splice(i, 1);
  localStorage.setItem("restaurants", JSON.stringify(data));
  render();
}

function render() {
  list.innerHTML = data.map((r, i) => `
    <div class="bg-white p-2 rounded shadow mb-2 flex justify-between">
      <span>${r.name} – ₹${r.price}</span>
      <button onclick="removeItem(${i})"
              class="text-red-500">Delete</button>
    </div>
  `).join("");
}

render();
</script>

</body>
</html>
